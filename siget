import threading
import time
import random

# --- Variables compartidas ---
buffer = []                # Almac칠n compartido entre sensores y analizadores
TAMANO_BUFFER = 5          # Capacidad m치xima del buffer

# --- Sem치foros ---
espacios_disponibles = threading.Semaphore(TAMANO_BUFFER)  # Controla los lugares libres
datos_disponibles = threading.Semaphore(0)                 # Controla los datos listos para analizar
acceso_exclusivo = threading.Semaphore(1)                  # Evita que 2 hilos usen el buffer al mismo tiempo

# --- Funci칩n de los sensores (Productores) ---
def sensor_trafico(id_sensor):
    while True:
        # Generar un dato de tr치fico aleatorio
        dato = random.randint(1, 100)
        espacios_disponibles.acquire()     # Espera si el buffer est치 lleno
        acceso_exclusivo.acquire()         # Entra a la secci칩n cr칤tica

        buffer.append(dato)
        print(f"游뚱 Sensor {id_sensor} envi칩 dato: {dato} | Buffer actual: {buffer}")

        acceso_exclusivo.release()         # Sale de la secci칩n cr칤tica
        datos_disponibles.release()        # Indica que hay un nuevo dato disponible

        time.sleep(random.uniform(0.5, 2)) # Espera un poco antes de enviar otro dato

# --- Funci칩n de los analizadores (Consumidores) ---
def analizador_trafico(id_analizador):
    while True:
        datos_disponibles.acquire()        # Espera si no hay datos
        acceso_exclusivo.acquire()         # Entra a la secci칩n cr칤tica

        dato = buffer.pop(0)
        print(f"游 Analizador {id_analizador} proces칩 dato: {dato} | Buffer actual: {buffer}")

        acceso_exclusivo.release()         # Sale de la secci칩n cr칤tica
        espacios_disponibles.release()     # Libera un espacio en el buffer

        time.sleep(random.uniform(1, 3))   # Simula el tiempo de an치lisis del dato

# --- Crear e iniciar los hilos ---
for i in range(3):  # Tres sensores de tr치fico
    hilo_sensor = threading.Thread(target=sensor_trafico, args=(i + 1,), daemon=True)
    hilo_sensor.start()

for i in range(2):  # Dos analizadores del sistema
    hilo_analizador = threading.Thread(target=analizador_trafico, args=(i + 1,), daemon=True)
    hilo_analizador.start()

# --- Mantener el programa en ejecuci칩n ---
while True:
    time.sleep(1)
    
